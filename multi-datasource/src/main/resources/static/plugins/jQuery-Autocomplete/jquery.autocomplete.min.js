(function(e){"use strict";if(typeof define==="function"&&define.amd){define(["jquery"],e)}else if(typeof exports==="object"&&typeof require==="function"){e(require("jquery"))}else{e(jQuery)}})(function(p){"use strict";var i=function(){return{escapeRegExChars:function(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")},createNode:function(e){var t=document.createElement("div");t.className=e;t.style.position="absolute";t.style.display="none";return t}}}(),n={ESC:27,TAB:9,RETURN:13,LEFT:37,UP:38,RIGHT:39,DOWN:40},e=p.noop;function o(e,t){var n=this;n.element=e;n.el=p(e);n.suggestions=[];n.badQueries=[];n.selectedIndex=-1;n.currentValue=n.element.value;n.timeoutId=null;n.cachedResponse={};n.onChangeTimeout=null;n.onChange=null;n.isLocal=false;n.suggestionsContainer=null;n.noSuggestionsContainer=null;n.options=p.extend({},o.defaults,t);n.classes={selected:"autocomplete-selected",suggestion:"autocomplete-suggestion"};n.hint=null;n.hintValue="";n.selection=null;n.initialize();n.setOptions(t)}o.utils=i;p.Autocomplete=o;o.defaults={ajaxSettings:{},autoSelectFirst:false,appendTo:"body",serviceUrl:null,lookup:null,onSelect:null,width:"auto",minChars:1,maxHeight:300,deferRequestBy:0,params:{},formatResult:r,formatGroup:a,delimiter:null,zIndex:9999,type:"GET",noCache:false,onSearchStart:e,onSearchComplete:e,onSearchError:e,preserveInput:false,containerClass:"autocomplete-suggestions",tabDisabled:false,dataType:"text",currentRequest:null,triggerSelectOnValidInput:true,preventBadQueries:true,lookupFilter:t,paramName:"query",transformResult:s,showNoSuggestionNotice:false,noSuggestionNotice:"No results",orientation:"bottom",forceFixPosition:false};function t(e,t,n){return e.value.toLowerCase().indexOf(n)!==-1}function s(e){return typeof e==="string"?p.parseJSON(e):e}function r(e,t){if(!t){return e.value}var n="("+i.escapeRegExChars(t)+")";return e.value.replace(new RegExp(n,"gi"),"<strong>$1</strong>").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/&lt;(\/?strong)&gt;/g,"<$1>")}function a(e,t){return'<div class="autocomplete-group">'+t+"</div>"}o.prototype={initialize:function(){var t=this,e="."+t.classes.suggestion,n=t.classes.selected,i=t.options,s;t.element.setAttribute("autocomplete","off");t.noSuggestionsContainer=p('<div class="autocomplete-no-suggestion"></div>').html(this.options.noSuggestionNotice).get(0);t.suggestionsContainer=o.utils.createNode(i.containerClass);s=p(t.suggestionsContainer);s.appendTo(i.appendTo||"body");if(i.width!=="auto"){s.css("width",i.width)}s.on("mouseover.autocomplete",e,function(){t.activate(p(this).data("index"))});s.on("mouseout.autocomplete",function(){t.selectedIndex=-1;s.children("."+n).removeClass(n)});s.on("click.autocomplete",e,function(){t.select(p(this).data("index"))});s.on("click.autocomplete",function(){clearTimeout(t.blurTimeoutId)});t.fixPositionCapture=function(){if(t.visible){t.fixPosition()}};p(window).on("resize.autocomplete",t.fixPositionCapture);t.el.on("keydown.autocomplete",function(e){t.onKeyPress(e)});t.el.on("keyup.autocomplete",function(e){t.onKeyUp(e)});t.el.on("blur.autocomplete",function(){t.onBlur()});t.el.on("focus.autocomplete",function(){t.onFocus()});t.el.on("change.autocomplete",function(e){t.onKeyUp(e)});t.el.on("input.autocomplete",function(e){t.onKeyUp(e)})},onFocus:function(){var e=this;e.fixPosition();if(e.el.val().length>=e.options.minChars){e.onValueChange()}},onBlur:function(){var e=this;e.blurTimeoutId=setTimeout(function(){e.hide()},200)},abortAjax:function(){var e=this;if(e.currentRequest){e.currentRequest.abort();e.currentRequest=null}},setOptions:function(e){var t=this,n=p.extend({},t.options,e);t.isLocal=Array.isArray(n.lookup);if(t.isLocal){n.lookup=t.verifySuggestionsFormat(n.lookup)}n.orientation=t.validateOrientation(n.orientation,"bottom");p(t.suggestionsContainer).css({"max-height":n.maxHeight+"px",width:n.width+"px","z-index":n.zIndex});this.options=n},clearCache:function(){this.cachedResponse={};this.badQueries=[]},clear:function(){this.clearCache();this.currentValue="";this.suggestions=[]},disable:function(){var e=this;e.disabled=true;clearTimeout(e.onChangeTimeout);e.abortAjax()},enable:function(){this.disabled=false},fixPosition:function(){var e=this,t=p(e.suggestionsContainer),n=t.parent().get(0);if(n!==document.body&&!e.options.forceFixPosition){return}var i=e.options.orientation,s=t.outerHeight(),o=e.el.outerHeight(),r=e.el.offset(),a={top:r.top,left:r.left};if(i==="auto"){var u=p(window).height(),l=p(window).scrollTop(),c=-l+r.top-s,g=l+u-(r.top+o+s);i=Math.max(c,g)===c?"top":"bottom"}if(i==="top"){a.top+=-s}else{a.top+=o}if(n!==document.body){var f=t.css("opacity"),d;if(!e.visible){t.css("opacity",0).show()}d=t.offsetParent().offset();a.top-=d.top;a.top+=n.scrollTop;a.left-=d.left;if(!e.visible){t.css("opacity",f).hide()}}if(e.options.width==="auto"){a.width=e.el.outerWidth()+"px"}if(e.options.right&&e.options.width==="auto"){a.width="";a.right=e.options.right+"px"}t.css(a)},isCursorAtEnd:function(){var e=this,t=e.el.val().length,n=e.element.selectionStart,i;if(typeof n==="number"){return n===t}if(document.selection){i=document.selection.createRange();i.moveStart("character",-t);return t===i.text.length}return true},onKeyPress:function(e){var t=this;if(!t.disabled&&!t.visible&&e.which===n.DOWN&&t.currentValue){t.suggest();return}if(t.disabled||!t.visible){return}switch(e.which){case n.ESC:t.el.val(t.currentValue);t.hide();break;case n.RIGHT:if(t.hint&&t.options.onHint&&t.isCursorAtEnd()){t.selectHint();break}return;case n.TAB:if(t.hint&&t.options.onHint){t.selectHint();return}if(t.selectedIndex===-1){t.hide();return}t.select(t.selectedIndex);if(t.options.tabDisabled===false){return}break;case n.RETURN:if(t.selectedIndex===-1){t.hide();return}t.select(t.selectedIndex);break;case n.UP:t.moveUp();break;case n.DOWN:t.moveDown();break;default:return}e.stopImmediatePropagation();e.preventDefault()},onKeyUp:function(e){var t=this;if(t.disabled){return}switch(e.which){case n.UP:case n.DOWN:return}clearTimeout(t.onChangeTimeout);if(t.currentValue!==t.el.val()){t.findBestHint();if(t.options.deferRequestBy>0){t.onChangeTimeout=setTimeout(function(){t.onValueChange()},t.options.deferRequestBy)}else{t.onValueChange()}}},onValueChange:function(){if(this.ignoreValueChange){this.ignoreValueChange=false;return}var e=this,t=e.options,n=e.el.val(),i=e.getQuery(n);if(e.selection&&e.currentValue!==i){e.selection=null;(t.onInvalidateSelection||p.noop).call(e.element)}clearTimeout(e.onChangeTimeout);e.currentValue=n;e.selectedIndex=-1;if(t.triggerSelectOnValidInput&&e.isExactMatch(i)){e.select(0);return}if(i.length<t.minChars){e.hide()}else{e.getSuggestions(i)}},isExactMatch:function(e){var t=this.suggestions;return t.length===1&&t[0].value.toLowerCase()===e.toLowerCase()},getQuery:function(e){var t=this.options.delimiter,n;if(!t){return e}n=e.split(t);return p.trim(n[n.length-1])},getSuggestionsLocal:function(t){var e=this,n=e.options,i=t.toLowerCase(),s=n.lookupFilter,o=parseInt(n.lookupLimit,10),r;r={suggestions:p.grep(n.lookup,function(e){return s(e,t,i)})};if(o&&r.suggestions.length>o){r.suggestions=r.suggestions.slice(0,o)}return r},getSuggestions:function(i){var e,s=this,o=s.options,t=o.serviceUrl,n,r,a;o.params[o.paramName]=i;if(o.onSearchStart.call(s.element,o.params)===false){return}n=o.ignoreParams?null:o.params;if(p.isFunction(o.lookup)){o.lookup(i,function(e){s.suggestions=e.suggestions;s.suggest();o.onSearchComplete.call(s.element,i,e.suggestions)});return}if(s.isLocal){e=s.getSuggestionsLocal(i)}else{if(p.isFunction(t)){t=t.call(s.element,i)}r=t+"?"+p.param(n||{});e=s.cachedResponse[r]}if(e&&Array.isArray(e.suggestions)){s.suggestions=e.suggestions;s.suggest();o.onSearchComplete.call(s.element,i,e.suggestions)}else if(!s.isBadQuery(i)){s.abortAjax();a={url:t,data:n,type:o.type,dataType:o.dataType};p.extend(a,o.ajaxSettings);s.currentRequest=p.ajax(a).done(function(e){var t;s.currentRequest=null;t=o.transformResult(e,i);s.processResponse(t,i,r);o.onSearchComplete.call(s.element,i,t.suggestions)}).fail(function(e,t,n){o.onSearchError.call(s.element,i,e,t,n)})}else{o.onSearchComplete.call(s.element,i,[])}},isBadQuery:function(e){if(!this.options.preventBadQueries){return false}var t=this.badQueries,n=t.length;while(n--){if(e.indexOf(t[n])===0){return true}}return false},hide:function(){var e=this,t=p(e.suggestionsContainer);if(p.isFunction(e.options.onHide)&&e.visible){e.options.onHide.call(e.element,t)}e.visible=false;e.selectedIndex=-1;clearTimeout(e.onChangeTimeout);p(e.suggestionsContainer).hide();e.signalHint(null)},suggest:function(){if(!this.suggestions.length){if(this.options.showNoSuggestionNotice){this.noSuggestions()}else{this.hide()}return}var e=this,i=e.options,s=i.groupBy,o=i.formatResult,r=e.getQuery(e.currentValue),a=e.classes.suggestion,t=e.classes.selected,n=p(e.suggestionsContainer),u=p(e.noSuggestionsContainer),l=i.beforeRender,c="",g,f=function(e,t){var n=e.data[s];if(g===n){return""}g=n;return i.formatGroup(e,g)};if(i.triggerSelectOnValidInput&&e.isExactMatch(r)){e.select(0);return}p.each(e.suggestions,function(e,t){if(s){c+=f(t,r,e)}var n=t.subValue==undefined?"":t.subValue;c+='<div class="'+a+'" data-index="'+e+'"><span class="suggestion-title">'+o(t,r,e)+'</span><span class="sub-suggestion-title">'+n+"</span></div>"});this.adjustContainerWidth();u.detach();n.html(c);if(p.isFunction(l)){l.call(e.element,n,e.suggestions)}e.fixPosition();n.show();if(i.autoSelectFirst){e.selectedIndex=0;n.scrollTop(0);n.children("."+a).first().addClass(t)}e.visible=true;e.findBestHint()},noSuggestions:function(){var e=this,t=e.options.beforeRender,n=p(e.suggestionsContainer),i=p(e.noSuggestionsContainer);this.adjustContainerWidth();i.detach();n.empty();n.append(i);if(p.isFunction(t)){t.call(e.element,n,e.suggestions)}e.fixPosition();n.show();e.visible=true},adjustContainerWidth:function(){var e=this,t=e.options,n,i=p(e.suggestionsContainer);if(t.width==="auto"){n=e.el.outerWidth();i.css("width",n>0?n:300)}else if(t.width==="flex"){i.css("width","")}},findBestHint:function(){var e=this,i=e.el.val().toLowerCase(),s=null;if(!i){return}p.each(e.suggestions,function(e,t){var n=t.value.toLowerCase().indexOf(i)===0;if(n){s=t}return!n});e.signalHint(s)},signalHint:function(e){var t="",n=this;if(e){t=n.currentValue+e.value.substr(n.currentValue.length)}if(n.hintValue!==t){n.hintValue=t;n.hint=e;(this.options.onHint||p.noop)(t)}},verifySuggestionsFormat:function(e){if(e.length&&typeof e[0]==="string"){return p.map(e,function(e){return{value:e,data:null}})}return e},validateOrientation:function(e,t){e=p.trim(e||"").toLowerCase();if(p.inArray(e,["auto","bottom","top"])===-1){e=t}return e},processResponse:function(e,t,n){var i=this,s=i.options;e.suggestions=i.verifySuggestionsFormat(e.suggestions);if(!s.noCache){i.cachedResponse[n]=e;if(s.preventBadQueries&&!e.suggestions.length){i.badQueries.push(t)}}if(t!==i.getQuery(i.currentValue)){return}i.suggestions=e.suggestions;i.suggest()},activate:function(e){var t=this,n,i=t.classes.selected,s=p(t.suggestionsContainer),o=s.find("."+t.classes.suggestion);s.find("."+i).removeClass(i);t.selectedIndex=e;if(t.selectedIndex!==-1&&o.length>t.selectedIndex){n=o.get(t.selectedIndex);p(n).addClass(i);return n}return null},selectHint:function(){var e=this,t=p.inArray(e.hint,e.suggestions);e.select(t)},select:function(e){var t=this;t.hide();t.onSelect(e)},moveUp:function(){var e=this;if(e.selectedIndex===-1){return}if(e.selectedIndex===0){p(e.suggestionsContainer).children("."+e.classes.suggestion).first().removeClass(e.classes.selected);e.selectedIndex=-1;e.ignoreValueChange=false;e.el.val(e.currentValue);e.findBestHint();return}e.adjustScroll(e.selectedIndex-1)},moveDown:function(){var e=this;if(e.selectedIndex===e.suggestions.length-1){return}e.adjustScroll(e.selectedIndex+1)},adjustScroll:function(e){var t=this,n=t.activate(e);if(!n){return}var i,s,o,r=p(n).outerHeight();i=n.offsetTop;s=p(t.suggestionsContainer).scrollTop();o=s+t.options.maxHeight-r;if(i<s){p(t.suggestionsContainer).scrollTop(i)}else if(i>o){p(t.suggestionsContainer).scrollTop(i-t.options.maxHeight+r)}if(!t.options.preserveInput){t.ignoreValueChange=true;t.el.val(t.getValue(t.suggestions[e].value))}t.signalHint(null)},onSelect:function(e){var t=this,n=t.options.onSelect,i=t.suggestions[e];t.currentValue=t.getValue(i.value);if(t.currentValue!==t.el.val()&&!t.options.preserveInput){t.el.val(t.currentValue)}t.signalHint(null);t.suggestions=[];t.selection=i;if(p.isFunction(n)){n.call(t.element,i)}},getValue:function(e){var t=this,n=t.options.delimiter,i,s;if(!n){return e}i=t.currentValue;s=i.split(n);if(s.length===1){return e}return i.substr(0,i.length-s[s.length-1].length)+e},dispose:function(){var e=this;e.el.off(".autocomplete").removeData("autocomplete");p(window).off("resize.autocomplete",e.fixPositionCapture);p(e.suggestionsContainer).remove()}};p.fn.devbridgeAutocomplete=function(n,i){var s="autocomplete";if(!arguments.length){return this.first().data(s)}return this.each(function(){var e=p(this),t=e.data(s);if(typeof n==="string"){if(t&&typeof t[n]==="function"){t[n](i)}}else{if(t&&t.dispose){t.dispose()}t=new o(this,n);e.data(s,t)}})};if(!p.fn.autocomplete){p.fn.autocomplete=p.fn.devbridgeAutocomplete}});